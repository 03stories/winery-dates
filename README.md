# Winery Dates Directory (Astro)

Static, SEO-friendly directory site built with Astro content collections and deployed to GitHub Pages.

## Requirements

- Node 22 (`.nvmrc`)
- npm 10+

## Local development

```bash
nvm use
npm install
npm run dev
```

## Build and preview

```bash
npm run build
npm run preview
```

## Environment variables

Copy `.env.example` to `.env` and adjust values:

```bash
SITE_URL=https://example.com
PUBLIC_ADS_ENABLED=false
PUBLIC_ADSENSE_CLIENT_ID=
PUBLIC_SUBMIT_LISTING_URL=https://github.com/<owner>/<repo>/issues/new?template=listing_submission.yml
PUBLIC_ADSENSE_PUBLISHER_ID=
PUBLIC_ADSENSE_SLOT_HOME_TOP=
PUBLIC_ADSENSE_SLOT_LISTING_INLINE=
```

- `SITE_URL`: used for canonical URLs, robots sitemap URL, and sitemap generation.
- `PUBLIC_ADS_ENABLED`: set to `true` to render AdSense containers and load the AdSense script.
- `PUBLIC_ADSENSE_CLIENT_ID`: AdSense client ID (`ca-pub-...`) loaded only when ads are enabled.
- `PUBLIC_SUBMIT_LISTING_URL`: URL to the GitHub issue template used by the "Submit a listing" flow.
- `PUBLIC_ADSENSE_PUBLISHER_ID`: publisher ID (`pub-...`) used by `/ads.txt`; defaults to `PUBLIC_ADSENSE_CLIENT_ID` without `ca-` when omitted.
- `PUBLIC_ADSENSE_SLOT_HOME_TOP`: AdSense slot ID used by the home page top ad placement.
- `PUBLIC_ADSENSE_SLOT_LISTING_INLINE`: AdSense slot ID used by listing detail inline ad placement.

## Content model and adding listings

Listings are Markdown files in `src/content/listings`.
The directory now includes all wineries from `src/data/wineries.ts` migrated into markdown content files.

Frontmatter schema:

- `title` (string)
- `slug` (string)
- `category` (string)
- `city` (string)
- `description` (string)
- `website` (optional URL, use `N/A` if unavailable)
- `phone` (optional string, use `N/A` if unavailable)
- `address` (optional string, use `N/A` if unavailable)
- `hours` (optional string, use `N/A` if unavailable)
- `rating` (optional number)
- `outsideFoodPolicy` (optional string, use `N/A` if unavailable)
- `outsideFoodCost` (optional string, use `N/A` if unavailable)
- `maps` (optional URL, use `N/A` if unavailable)
- `featured` (boolean, defaults to `false`)
- `updated` (optional date)

To add a listing:

1. Create a new `.md` file in `src/content/listings`.
2. Fill required frontmatter fields.
3. Keep `slug` unique.
4. Run `npm run build` to validate content and route generation.

## Routes generated

- `/` home page with featured + latest listings
- `/listing/[slug]` listing detail page
- `/category/[category]` category index pages
- `/city/[city]` city index pages
- `/categories` and `/cities` taxonomy landing pages
- `/search` powered by Pagefind full-text search
- `/about`, `/contact`, `/submit-listing`, `/privacy-policy`, `/terms`, `/404`

## Search

Pagefind is generated as part of `npm run build` and outputs static search assets to `dist/pagefind`.

## SEO defaults

- Canonical URLs and OpenGraph basics in `BaseLayout`
- JSON-LD schema on listing detail pages
- `robots.txt` generated by `src/pages/robots.txt.ts` so sitemap URL matches runtime configuration
- `sitemap.xml` generated by `@astrojs/sitemap` during build

## GitHub Pages deployment

Workflow: `.github/workflows/deploy.yml`

1. In GitHub repository settings, open **Pages**.
2. Set **Source** to **GitHub Actions**.
3. Push to `main` (or run workflow manually).

The workflow installs deps, builds Astro output, uploads `dist`, and deploys with official Pages actions.

Set repository **Settings → Secrets and variables → Actions → Variables**:

- `SITE_URL=https://03stories.github.io/winery-dates` for GitHub Pages project URLs.
- Later, switch to `SITE_URL=https://yourdomain.com` after moving to a custom root domain.

### Canonical URL rules

- If `SITE_URL` includes a path (for example `/winery-dates`), canonical URLs keep that path.
- If `SITE_URL` has no path (for example `https://yourdomain.com`), canonical URLs are emitted at the root path.
- `BASE_URL` controls routing/build paths; canonical URLs prefer the path encoded in `SITE_URL` when present, and otherwise fall back to `BASE_URL`.

## Custom domain setup

1. Copy `public/CNAME.example` to `public/CNAME`.
2. Replace placeholder content with your real domain only.
3. Configure DNS:
   - apex domain: `A`/`AAAA` records for GitHub Pages
   - subdomain: `CNAME` to `<username>.github.io`
4. Set the same custom domain in GitHub Pages settings.

Do **not** commit a real domain unless the repository is ready for production DNS.

## Ads and ads.txt

- Ad script loading is gated by `PUBLIC_ADS_ENABLED=true` and a non-empty `PUBLIC_ADSENSE_CLIENT_ID`.
- Ad containers render only when ads are enabled and placement slot IDs are set with public env vars.
- `GET /ads.txt` is generated by `src/pages/ads.txt.ts` and returns a Google seller line when a publisher ID is configured.
