---
import { getCollection } from 'astro:content';
import ListingCard from '../../components/ListingCard.astro';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { denormalizeTaxonomyValue, normalizeTaxonomyValue } from '../../utils/listing';

export async function getStaticPaths() {
  const listings = await getCollection('listings');
  const categories = [...new Set(listings.map((listing) => listing.data.category))];

  return categories.map((category) => ({
    params: { category: normalizeTaxonomyValue(category) },
    props: { category },
  }));
}

const { category } = Astro.props;
const listings = (await getCollection('listings')).filter((listing) => listing.data.category === category);
const heading = denormalizeTaxonomyValue(Astro.params.category || '');
---

<BaseLayout
  title={`Category: ${heading}`}
  description={`Browse listings in the ${heading} category.`}
>
  <h1>{heading}</h1>
  <p>{listings.length} listings</p>
  {listings.map((listing) => <ListingCard listing={listing} />)}
</BaseLayout>
