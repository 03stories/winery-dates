---
import { getCollection } from 'astro:content';
import ListingCard from '../components/ListingCard.astro';
import AdSlot from '../components/AdSlot.astro';
import BaseLayout from '../layouts/BaseLayout.astro';

const listings = (await getCollection('listings')).sort(
  (a, b) => new Date(b.data.updated ?? 0).getTime() - new Date(a.data.updated ?? 0).getTime(),
);
const featured = listings.filter((listing) => listing.data.featured);
---

<BaseLayout
  title="Home"
  description="Discover featured wineries and date-night listings across North Georgia."
>
  <h1>Winery Dates Directory</h1>
  <p>A focused local directory for date-night winery spots, tours, and nearby planning services.</p>

  <AdSlot slotName="home-top" position="top" />

  <section>
    <h2>Featured Listings</h2>
    {featured.length === 0 ? <p>No featured listings yet.</p> : featured.map((listing) => <ListingCard listing={listing} />)}
  </section>

  <section>
    <h2>Latest Listings</h2>
    {listings.map((listing) => <ListingCard listing={listing} />)}
  </section>
</BaseLayout>
