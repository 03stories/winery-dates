---
import BaseLayout from '../layouts/BaseLayout.astro';
import { toBasePath } from '../config/site';

const pagefindBase = toBasePath('/');
---

<BaseLayout
  title="Search"
  description="Search winery listings, categories, and city pages across Winery Dates Directory."
>
  <h1>Search listings</h1>
  <p>Use keyword search to quickly find wineries, city pages, and category pages.</p>

  <div id="search"></div>

  <link rel="stylesheet" href={toBasePath('/pagefind/pagefind-ui.css')} />
  <script define:vars={{ pagefindBase }}>
    window.addEventListener('DOMContentLoaded', () => {
      if (typeof window.PagefindUI !== 'function') {
        return;
      }

      new window.PagefindUI({
        element: '#search',
        baseUrl: pagefindBase,
        showSubResults: true,
        resetStyles: false,
        autofocus: true,
      });

      const initialQuery = new URL(window.location.href).searchParams.get('q')?.trim();
      if (!initialQuery) {
        return;
      }

      window.requestAnimationFrame(() => {
        const input = document.querySelector('#search .pagefind-ui__search-input');
        if (!(input instanceof HTMLInputElement)) {
          return;
        }

        input.value = initialQuery;
        input.dispatchEvent(new Event('input', { bubbles: true }));
      });
    });
  </script>
  <script src={toBasePath('/pagefind/pagefind-ui.js')} defer></script>
</BaseLayout>

<style>
  #search {
    margin-top: 1rem;
    max-width: 720px;
  }

  :global(.pagefind-ui__result-title),
  :global(.pagefind-ui__drawer),
  :global(.pagefind-ui__message) {
    font-family: Inter, system-ui, sans-serif;
  }


  :global(.pagefind-ui__search-input) {
    border-radius: 0.75rem;
    border: 1px solid #e8d2e3;
    background: rgb(255 255 255 / 93%);
  }

  :global(.pagefind-ui__result) {
    border-radius: 0.85rem;
    border: 1px solid #edd8e7;
    background: linear-gradient(160deg, rgb(255 255 255 / 96%), rgb(253 246 250 / 80%));
    padding: 0.8rem;
  }

  :global(.pagefind-ui__button) {
    border-radius: 0.65rem;
    border-color: #d9a8c4;
    background: #a54a7b;
  }

</style>
